---
import PageLayout from "../../layouts/PageLayout.astro";
import FilterDropdown from "../../components/FilterDropdown.astro";
import ProductCarousel from "../../components/ProductCarousel.astro";
import ProductModal from "../../components/ProductModal.astro";
import SolutionsHero from "../../components/SolutionsHero.astro";
import SolutionsCarousel from "../../components/SolutionsCarousel.astro";
import CTASection from "../../components/CTASection.astro";
import {
  getAllProducts,
  getAllArticles,
  getHomeContent,
} from "../../utils/prismic";
import {
  filterProducts,
  getDefaultFilterState,
  searchParamsToFilterState,
} from "../../utils/filterLogic";
import type { Producto, FilterState } from "../../types";

const lang = "es";

// Fetch products and articles
let allProducts: Producto[] = [];
let articles: any[] = [];
let prismicHomeContent = null;

try {
  allProducts = await getAllProducts(lang);
  articles = await getAllArticles(lang);
  prismicHomeContent = await getHomeContent(lang);
} catch (error) {
  console.error("Error fetching data:", error);
}

// Use Prismic content if available, otherwise use mockup
const homeContent = prismicHomeContent || {
  hero: {
    title: "DEKALB EXPERIENCE",
    claim: "SIEMPRE A TU LADO",
  },
  solutions: {
    integralMaiz: "Soluciones Integrales para Ma√≠z",
    fieldview: "FieldView",
    protection: "Protecci√≥n de Cultivo",
    preceon: "Smart Corn System PRECEON",
    avoidProblems: "Evita problemas con tu ma√≠z",
  },
};

// Get filter state from URL params
const url = Astro.url;
const filterState: FilterState = searchParamsToFilterState(url.searchParams);

// Debug: Log URL params and filter state (server-side)
console.log("üîó [SERVER] URL:", url.href);
console.log("üîó [SERVER] URL Search:", url.search);
console.log(
  "üîó [SERVER] Search Params:",
  Array.from(url.searchParams.entries())
);
console.log(
  "üìã [SERVER] Parsed Filter State:",
  JSON.stringify(filterState, null, 2)
);
console.log("üìã [SERVER] FilterState tipoSemilla:", filterState.tipoSemilla);
console.log("üìã [SERVER] FilterState proteccion:", filterState.proteccion);
console.log("üìã [SERVER] FilterState uso:", filterState.uso);
console.log("üìã [SERVER] FilterState zona:", filterState.zona);
console.log("üìã [SERVER] All Products count:", allProducts.length);
console.log(
  "üìã [SERVER] All Products details:",
  allProducts.map((p) => ({
    nombre: p.nombre,
    tipo_semilla: p.tipo_semilla,
    proteccion: p.proteccion,
    uso: p.uso,
    zona: p.zona,
  }))
);

// Filter products based on current filter state
const filteredProducts = filterProducts(allProducts, filterState);
console.log("üìã [SERVER] Filtered Products count:", filteredProducts.length);
console.log(
  "üìã [SERVER] Filtered Products details:",
  filteredProducts.map((p) => ({
    nombre: p.nombre,
    tipo_semilla: p.tipo_semilla,
    proteccion: p.proteccion,
    uso: p.uso,
    zona: p.zona,
  }))
);

// Get latest 4 articles for blog preview
const latestArticles = articles.slice(0, 4);
---

<PageLayout
  title={homeContent.hero.title}
  description={homeContent.hero.claim}
  lang={lang}
>
  <!-- Hero + Products Section (Desktop) -->
  <section class="hero-products-section">
    <div class="hero-products-background"></div>
    <div class="hero-products-overlay"></div>
    <div class="hero-products-container">
      <!-- Hero Content -->
      <div class="hero-products-header">
        <h1 class="hero-products-title">{homeContent.hero.title}</h1>
        <p class="hero-products-subtitle">{homeContent.hero.claim}</p>
      </div>

      <!-- Filters -->
      <div class="hero-products-filters">
        <FilterDropdown
          filterState={filterState}
          lang={lang}
        />
      </div>

      <!-- Products Carousel -->
      <div class="hero-products-carousel">
        <ProductCarousel
          products={filteredProducts}
          lang={lang}
          carouselId="product-carousel-desktop"
        />
      </div>
    </div>
  </section>

  <!-- Mobile: Combined Hero + Products Section -->
  <section class="mobile-hero-section">
    <div class="mobile-hero-background"></div>
    <div class="mobile-hero-overlay"></div>
    <div class="mobile-hero-content">
      <SolutionsHero
        title={homeContent.hero.title}
        subtitle={homeContent.hero.claim}
      />
    </div>
    <div class="mobile-products-content">
      <div class="container">
        <FilterDropdown
          filterState={filterState}
          lang={lang}
        />
        <ProductCarousel
          products={filteredProducts}
          lang={lang}
          carouselId="product-carousel-mobile"
        />
      </div>
    </div>
  </section>

  <!-- Filter Script (works for both desktop and mobile) -->
  <script
    define:vars={{
      filterStateJson: JSON.stringify(filterState),
      allProductsJson: JSON.stringify(allProducts),
      filteredProductsJson: JSON.stringify(filteredProducts),
    }}
  >
    // Parse filterState from JSON (Astro serialization)
    const filterState = JSON.parse(filterStateJson);
    const allProducts = JSON.parse(allProductsJson);
    const filteredProducts = JSON.parse(filteredProductsJson);

    // Expose allProducts globally for FilterDropdown component
    window.__allProducts = allProducts;

    // ALSO parse from current URL to ensure we have the latest state
    const urlParams = new URLSearchParams(window.location.search);
    const urlFilterState = {
      tipoSemilla:
        urlParams.get("tipo") === "maiz" || urlParams.get("tipo") === "colza"
          ? urlParams.get("tipo")
          : undefined,
      uso: urlParams.get("uso") || undefined,
      zona: urlParams.get("zona") || undefined,
      proteccion: urlParams.get("proteccion") || "todos",
    };

    // Debug logs in browser console
    console.log(
      "üîç [CLIENT] Server Filter State:",
      JSON.stringify(filterState, null, 2)
    );
    console.log(
      "üîç [CLIENT] URL Filter State:",
      JSON.stringify(urlFilterState, null, 2)
    );
    console.log(
      "üîç [CLIENT] FilterState tipoSemilla:",
      filterState.tipoSemilla
    );
    console.log("üîç [CLIENT] FilterState proteccion:", filterState.proteccion);
    console.log("üì¶ All Products:", allProducts.length);
    console.log("‚úÖ Filtered Products (from server):", filteredProducts.length);

    if (allProducts.length > 0) {
      console.log(
        "üìã All Products Details:",
        allProducts.map((p) => ({
          nombre: p.nombre,
          tipo_semilla: p.tipo_semilla,
          proteccion: p.proteccion,
          uso: p.uso,
          zona: p.zona,
        }))
      );
      console.log(
        "‚úÖ Filtered Products Details (from server):",
        filteredProducts.map((p) => ({
          nombre: p.nombre,
          tipo_semilla: p.tipo_semilla,
          proteccion: p.proteccion,
          uso: p.uso,
          zona: p.zona,
        }))
      );

      // Client-side filtering as fallback ONLY if server filtering didn't work
      // Check if server filtering worked by comparing URL params with filtered products
      const hasActiveFilters =
        urlFilterState.tipoSemilla ||
        urlFilterState.uso ||
        urlFilterState.zona ||
        (urlFilterState.proteccion && urlFilterState.proteccion !== "todos");

      if (hasActiveFilters) {
        // Check if server filtering worked correctly
        const serverFilteredCorrectly =
          filteredProducts.length < allProducts.length ||
          filteredProducts.some((p) => {
            if (
              urlFilterState.tipoSemilla &&
              p.tipo_semilla !== urlFilterState.tipoSemilla
            )
              return false;
            if (
              urlFilterState.proteccion &&
              urlFilterState.proteccion !== "todos" &&
              p.proteccion !== urlFilterState.proteccion
            )
              return false;
            if (urlFilterState.uso && p.uso !== urlFilterState.uso)
              return false;
            if (urlFilterState.zona && p.zona !== urlFilterState.zona)
              return false;
            return true;
          });

        if (
          !serverFilteredCorrectly &&
          filteredProducts.length === allProducts.length
        ) {
          console.log(
            "‚ö†Ô∏è [CLIENT] Server filtering may have failed, applying client-side filter..."
          );
          let clientFiltered = [...allProducts];

          if (urlFilterState.tipoSemilla) {
            const before = clientFiltered.length;
            clientFiltered = clientFiltered.filter(
              (p) => p.tipo_semilla === urlFilterState.tipoSemilla
            );
            console.log(
              `üîç Client filter tipoSemilla: ${before} -> ${clientFiltered.length}`
            );
          }

          if (urlFilterState.uso) {
            const before = clientFiltered.length;
            clientFiltered = clientFiltered.filter(
              (p) => p.uso === urlFilterState.uso
            );
            console.log(
              `üîç Client filter uso: ${before} -> ${clientFiltered.length}`
            );
          }

          if (urlFilterState.zona) {
            const before = clientFiltered.length;
            clientFiltered = clientFiltered.filter(
              (p) => p.zona === urlFilterState.zona
            );
            console.log(
              `üîç Client filter zona: ${before} -> ${clientFiltered.length}`
            );
          }

          if (
            urlFilterState.proteccion &&
            urlFilterState.proteccion !== "todos"
          ) {
            const before = clientFiltered.length;
            clientFiltered = clientFiltered.filter(
              (p) => p.proteccion === urlFilterState.proteccion
            );
            console.log(
              `üîç Client filter proteccion: ${before} -> ${clientFiltered.length}`
            );
          }

          console.log(
            "‚úÖ Client-side Filtered Products:",
            clientFiltered.map((p) => ({
              nombre: p.nombre,
              tipo_semilla: p.tipo_semilla,
              proteccion: p.proteccion,
            }))
          );

          // Update carousel with client-filtered products
          if (clientFiltered.length !== filteredProducts.length) {
            console.log(
              "‚ö†Ô∏è [CLIENT] Updating carousel with client-filtered products"
            );
            // Wait a bit for carousel to be ready
            setTimeout(() => {
              const event = new CustomEvent("updateProducts", {
                detail: { products: clientFiltered },
              });
              document.dispatchEvent(event);
            }, 100);
          }
        } else {
          console.log(
            "‚úÖ [CLIENT] Server filtering worked correctly, using server-filtered products"
          );
        }
      }
    }
  </script>

  <!-- Solutions Section -->
  <section
    id="soluciones"
    class="solutions-section"
  >
    <div class="container">
      <h2 class="section-title">Soluciones</h2>
      <p class="section-description">
        Descubre nuestras soluciones integrales para el cultivo de ma√≠z.
      </p>
      <SolutionsCarousel
        solutions={[
          {
            id: "acceleron",
            name: "Acceleron",
            description:
              "Protege y nutre tu ma√≠z con Acceleron¬Æ para un cultivo sano y productivo.",
            logo: "/Logo_Acceleron.svg",
            icon: "/Icon_Acceleron.svg",
          },
          {
            id: "fieldshield",
            name: "FieldShield",
            description:
              "Fortalece tu ma√≠z. FieldShield reduce el riesgo de enfermedades y mejora el rendimiento.",
            logo: "/Logo_Fieldshield.svg",
            icon: "/Icon_FieldShield.svg",
          },
          {
            id: "silo-extra",
            name: "Silo Extra",
            description:
              "M√°s calidad, m√°s cantidad. Descubre los h√≠bridos SiloExtra y mejora tu cosecha.",
            logo: "/Logo_SiloExtra.svg",
            icon: "/Icon_SiloExtra.svg",
          },
          {
            id: "preceon",
            name: "Preceon",
            description:
              "Protege tu ma√≠z desde el primer d√≠a con las soluciones Bayer m√°s eficaces.",
            logo: "/Logo_Preceon.svg",
            icon: "/Icon_Preceon.svg",
          },
          {
            id: "fieldview",
            name: "FieldView",
            description:
              "S√°cale partido a tus datos. Accede a FieldView y toma decisiones m√°s inteligentes en cada campa√±a.",
            logo: "/Logo_Fieldview.svg",
            icon: "/Icon_FieldView.svg",
          },
        ]}
        lang={lang}
      />
    </div>
  </section>

  <!-- FieldView Section -->
  <!-- <section class="fieldview-section">
    <div class="container">
      <CTASection
        title={homeContent.solutions.fieldview}
        description="Plataforma digital para gesti√≥n agr√≠cola avanzada"
        buttonText="Conocer m√°s"
        buttonLink="/es/fieldview"
        variant="primary"
        lang={lang}
      />
    </div>
  </section> -->

  <!-- Protecci√≥n de Cultivo Section -->
  <!-- <section class="protection-section">
    <div class="container">
      <CTASection
        title={homeContent.solutions.protection}
        description="Soluciones innovadoras para la protecci√≥n de tus cultivos"
        buttonText="Ver soluciones"
        buttonLink="/es/#soluciones"
        variant="secondary"
        lang={lang}
      />
    </div>
  </section> -->

  <!-- Preceon Section -->
  <section class="preceon-section">
    <div class="container">
      <div class="content-left-card-wrapper">
        <div class="content-left-card-content">
          <div class="content-left-card-logo">
            <img
              src="/Logo_Preceon.svg"
              alt="Preceon"
            />
          </div>
          <h2 class="content-left-card-title">
            El futuro del ma√≠z est√° aqu√≠, accede para descubrirlo.
          </h2>
          <a
            href="/es/preceon"
            class="btn btn-primary"
            >Descubrir</a
          >
        </div>
        <div class="content-left-card-image">
          <img
            src="/card_background-preceon.png"
            alt="Preceon Pack"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Calculadora de Densidades Section -->
  <section class="calculator-section">
    <div class="container">
      <div class="content-right-card-wrapper">
        <div class="content-right-card-image">
          <img
            src="/card_background-calculadora.png"
            alt="Calculadora de densidades"
          />
        </div>
        <div class="content-right-card-content">
          <h2 class="content-right-card-title">Calculador de densidades</h2>
          <p class="content-right-card-description">
            Usa nuestra herramienta interactiva para calcular la densidad de
            siembra recomendada y el n√∫mero de bolsas DEKALB requeridas.
          </p>
          <a
            href="/es/calculadora"
            class="btn btn-primary"
            >Accede al calculador</a
          >
        </div>
      </div>
    </div>
  </section>
  <!-- Guides Section -->
  <section class="guides-section">
    <div class="container">
      <div class="content-left-card-wrapper">
        <div class="content-left-card-content">
          <h2 class="content-left-card-title">Evita problemas con tu ma√≠z</h2>
          <p>
            Descubre nuestras gu√≠as para ayudarte a proteger tu cultivo de ma√≠z.
          </p>
          <a
            href="/es/preceon"
            class="btn btn-primary"
            >Ver gu√≠as de cultivo</a
          >
        </div>
        <div class="content-left-card-image">
          <img
            src="/card_background-guides.png"
            alt="Gu√≠as de cultivo"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Catalogs Section -->
  <section class="catalogs-section">
    <div class="container">
      <div class="content-right-card-wrapper">
        <div class="content-right-card-image">
          <img
            src="/card_background-catalogs.png"
            alt="Cat√°logos"
          />
        </div>
        <div class="content-right-card-content">
          <h2 class="content-right-card-title">
            Obt√©n todos nuestros cat√°logos en un s√≥lo lugar.
          </h2>
          <p class="content-right-card-description">
            Soluciones, Gu√≠as, Cat√°logos. ‚Ä®Elige tu pa√≠s y accede.
          </p>
          <a
            href="/es/calculadora"
            class="btn btn-primary"
            >Ver cat√°logos</a
          >
        </div>
      </div>
    </div>
  </section>
  <!-- Evita Problemas Section -->
  <!-- <section class="avoid-problems-section">
    <div class="container">
      <CTASection
        title={homeContent.solutions.avoidProblems}
        buttonText="Ver gu√≠as"
        buttonLink="/es/evita-problemas"
        variant="primary"
        lang={lang}
      />
    </div>
  </section> -->

  <!-- Cat√°logos Download Section -->
  <section class="catalogs-download-section">
    <div class="container">
      <h2 class="section-title">Descarga de Cat√°logos</h2>
      <div class="catalogs-grid">
        <a
          href="/es/catalogo"
          class="catalog-card"
        >
          <span class="catalog-flag">üá™üá∏</span>
          <span class="catalog-name">Espa√±a</span>
        </a>
        <a
          href="/pt/catalogo"
          class="catalog-card"
        >
          <span class="catalog-flag">üáµüáπ</span>
          <span class="catalog-name">Portugal</span>
        </a>
      </div>
    </div>
  </section>

  <!-- Blog Preview Section -->
  {
    latestArticles.length > 0 && (
      <section class="news-section">
        <div class="container">
          <div class="news-header">
            <h2 class="news-title">Actualidad Dekalb</h2>
            <p class="news-subtitle">
              Noticias, eventos y novedades para estar siempre al d√≠a con todo
              lo que ocurre en el mundo Dekalb.
            </p>
          </div>
          <div class="news-grid">
            {latestArticles.map((article) => (
              <article class="news-card">
                <div class="news-card-image-wrapper">
                  {article.imagen_destacada?.url && (
                    <img
                      src={article.imagen_destacada.url}
                      alt={article.imagen_destacada.alt || article.titulo}
                      class="news-card-image"
                      loading="lazy"
                    />
                  )}
                  <span class="news-card-tag">{article.categoria}</span>
                </div>
                <div class="news-card-content">
                  <p class="news-card-date">
                    {new Date(article.fecha).toLocaleDateString("es-ES", {
                      day: "2-digit",
                      month: "long",
                      year: "numeric",
                    })}
                  </p>
                  <h3 class="news-card-title">{article.titulo}</h3>
                  <a
                    href={`/es/blog/${article.slug}`}
                    class="news-card-link"
                  >
                    Leer m√°s
                  </a>
                </div>
              </article>
            ))}
          </div>
          <div class="news-footer">
            <p class="news-footer-text">
              Sigue conectado a la innovaci√≥n y al campo.
            </p>
            <a
              href="/es/blog"
              class="btn btn-primary news-footer-button"
            >
              Ver todas las noticias
            </a>
          </div>
        </div>
      </section>
    )
  }

  <ProductModal lang={lang} />
</PageLayout>

<style>
  /* Hero + Products Combined Section (Desktop) */
  .hero-products-section {
    position: relative;
    min-height: 80vh;
    display: none;
    overflow: hidden;
  }

  @media (min-width: 1024px) {
    .hero-products-section {
      display: block;
    }
  }

  .hero-products-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("/Frame_1410119213.jpg");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: 0;
  }

  .hero-products-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.3) 0%,
      rgba(0, 0, 0, 0.1) 50%,
      rgba(0, 0, 0, 0.2) 100%
    );
    z-index: 1;
  }

  .hero-products-container {
    position: relative;
    z-index: 2;
    padding-top: calc(var(--header-height) + var(--spacing-8));
    padding-bottom: var(--spacing-16);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-6);
    min-height: calc(100vh - var(--header-height));
    width: 100%;
    max-width: 100%;
  }

  .hero-products-header {
    text-align: center;
    color: var(--color-white);
  }

  .hero-products-title {
    font-size: var(--hero-title-size);
    font-weight: var(--font-weight-bold);
    color: var(--color-white);
    margin-bottom: var(--spacing-3);
    line-height: var(--line-height-tight);
    letter-spacing: var(--letter-spacing-normal);
  }

  .hero-products-subtitle {
    font-size: var(--hero-subtitle-size);
    color: var(--color-white);
    margin: 0;
    line-height: var(--line-height-normal);
    font-weight: var(--font-weight-regular);
  }

  .hero-products-filters {
    margin-top: var(--spacing-8);
    display: flex;
    justify-content: center;
  }

  .hero-products-carousel {
    width: 100%;
  }

  /* Hide section title in desktop hero-products section */
  .hero-products-section .section-title {
    display: none;
  }

  /* Mobile: Combined Hero + Products Section */
  .mobile-hero-section {
    display: block;
    position: relative;
    min-height: 100vh;
    overflow: hidden;
    padding-top: 0;
    margin-top: 0;
  }

  .mobile-hero-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("/Frame_1410119213.png");
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: 0;
  }

  .mobile-hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.2);
    z-index: 1;
  }

  .mobile-hero-content {
    position: relative;
    z-index: 2;
    padding-top: var(--spacing-4);
  }

  .mobile-products-content {
    position: relative;
    z-index: 2;
    padding: var(--spacing-8) 0 var(--spacing-16) 0;
    margin-top: var(--spacing-4);
  }

  .mobile-products-content .section-title {
    color: var(--color-white);
  }

  @media (min-width: 1024px) {
    .mobile-hero-section {
      display: none;
    }
  }

  .products-section {
    padding: var(--spacing-16) 0;
    background-color: var(--color-white);
  }

  .section-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    text-align: center;
    margin-bottom: var(--spacing-4);
    color: var(--color-white);
    line-height: var(--line-height-tight);
  }

  .section-description {
    font-size: var(--font-size-lg);
    text-align: center;
    margin-bottom: var(--spacing-8);
    color: var(--color-white);
    line-height: var(--line-height-relaxed);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .solutions-section {
    padding: var(--spacing-16) 0;
    background: var(--gradient-hero-solutions);
  }

  .solutions-section .section-title,
  .solutions-section .section-description {
    color: var(--color-white);
  }

  .fieldview-section,
  .protection-section {
    padding: var(--spacing-12) 0;
  }

  /* Generic Card Sections - Layout Styles */
  .preceon-section,
  .calculator-section,
  .guides-section,
  .catalogs-section {
    padding: var(--spacing-16) 0;
    background: transparent;
    color: var(--color-text-primary);
  }

  /* Content Left Card (30% contenido / 70% imagen) */
  .content-left-card-wrapper {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0;
    align-items: stretch;
    background: var(--color-white);
    border-radius: 12px 12px 12px 12px;
    overflow: hidden;
    min-height: 500px;
    position: relative;
  }

  .content-left-card-content {
    text-align: left;
    padding: var(--spacing-12) var(--spacing-8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: linear-gradient(to right, #e9e7e4 0%, #ffffff 100%);
    position: relative;
    z-index: 2;
  }

  .content-left-card-logo {
    margin-bottom: var(--spacing-8);
    display: block;
  }

  .content-left-card-logo img {
    height: 110px;
    width: auto;
    object-fit: cover;
    display: block;
  }

  .content-left-card-content .btn {
    width: auto;
    max-width: 212px;
    display: inline-block;
    text-align: center;
  }

  .content-left-card-image {
    display: none;
    position: relative;
    overflow: hidden;
  }

  .content-left-card-image img {
    width: 100%;
    height: 100%;
    object-fit: fill;
    display: block;
  }

  /* Desktop: Content Left Card - 30% contenido / 70% imagen */
  @media (min-width: 1024px) {
    .content-left-card-wrapper {
      grid-template-columns: 30% 70%;
      gap: 0;
      min-height: 400px;
      border-radius: 60px 12px 60px 12px; /* Superior izquierda e inferior derecha con radio mayor */
    }

    .content-left-card-content {
      padding: var(--spacing-12) var(--spacing-12);
      border-radius: 60px 0 0 0px; /* Solo esquina superior izquierda redondeada */
    }

    .content-left-card-image {
      display: block;
      border-radius: 0 12px 60px 0; /* Solo esquina inferior derecha redondeada */
    }
  }

  /* Content Right Card (65% imagen / 35% contenido) */
  .content-right-card-wrapper {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0;
    align-items: stretch;
    background: var(--color-white);
    border-radius: 12px 12px 12px 12px;
    overflow: hidden;
    min-height: 400px;
    position: relative;
  }

  .content-right-card-content {
    text-align: left;
    padding: var(--spacing-12) var(--spacing-8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    z-index: 2;
  }

  .content-right-card-title,
  .content-left-card-title {
    font-size: 1.7rem;
    font-weight: 700;
    font-family: var(--font-family-primary);
    color: #00527f;
    margin-bottom: var(--spacing-6);
    line-height: 1.8rem;
    max-width: 345px;
    display: block;
  }
  .content-left-card-title {
    max-width: 423px;
  }

  .content-right-card-description {
    font-size: 20px;
    font-weight: 400;
    font-family: var(--font-family-primary);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-8);
    line-height: 26px;
    max-width: 345px;
    display: block;
  }

  .content-right-card-content .btn {
    width: auto;
    max-width: 212px;
    display: inline-block;
    text-align: center;
  }

  .content-right-card-image {
    display: none;
    position: relative;
    overflow: hidden;
  }

  .content-right-card-image img {
    width: 100%;
    height: 100%;
    object-fit: fill;
    display: block;
  }

  /* Desktop: Content Right Card - 65% imagen / 35% contenido */
  @media (min-width: 1024px) {
    .content-right-card-wrapper {
      grid-template-columns: 65% 35%;
      gap: 0;
      min-height: 400px;
      border-radius: 60px 12px 60px 12px; /* Superior derecha e inferior izquierda con radio mayor */
      background: linear-gradient(to left, #e9e7e4 0%, #ffffff 100%);
    }

    .content-right-card-content {
      padding: var(--spacing-12) var(--spacing-12);
    }

    .content-right-card-image {
      display: block;
    }
  }

  .avoid-problems-section {
    padding: var(--spacing-12) 0;
    background-color: var(--color-gray-50);
  }

  .catalogs-download-section {
    padding: var(--spacing-16) 0;
    background-color: var(--color-white);
  }

  .catalogs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-6);
    max-width: 600px;
    margin: 0 auto;
  }

  .catalog-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-3);
    padding: var(--spacing-6);
    background: var(--color-white);
    border: none;
    border-radius: var(--card-border-radius);
    text-decoration: none;
    transition: all var(--transition-base);
  }

  @media (max-width: 767px) {
    .catalog-card {
      background: var(--catalog-button-bg-mobile);
      color: var(--catalog-button-text-mobile);
    }
  }

  @media (min-width: 768px) {
    .catalog-card {
      background: var(--catalog-button-bg-desktop);
      color: var(--catalog-button-text-desktop);
    }
  }

  .catalog-card:hover {
    opacity: 0.9;
    transform: translateY(-2px);
  }

  .catalog-flag {
    font-size: 3rem;
  }

  .catalog-name {
    font-weight: var(--font-weight-bold);
    font-size: var(--button-font-size);
    color: inherit;
  }

  /* News Section */
  .news-section {
    padding: var(--spacing-16) 0;
    background-color: var(--color-white);
  }

  .news-header {
    text-align: center;
    margin-bottom: var(--spacing-12);
  }

  .news-title {
    font-size: 48px;
    font-weight: 700;
    font-family: var(--font-family-primary);
    color: #00527f;
    margin: 0 0 var(--spacing-4) 0;
    letter-spacing: 0.96px;
    line-height: 48px;
  }

  .news-subtitle {
    font-size: 20px;
    font-weight: 400;
    font-family: var(--font-family-primary);
    color: #313639;
    margin: 0;
    line-height: 26px;
    max-width: 645px;
    margin-left: auto;
    margin-right: auto;
  }

  .news-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--spacing-6);
    margin-bottom: var(--spacing-12);
  }

  .news-card {
    background: linear-gradient(to bottom, #e9e7e4 0%, #ffffff 100%);
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: all var(--transition-base);
  }

  .news-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .news-card-image-wrapper {
    position: relative;
    width: 100%;
    height: 177px;
    overflow: hidden;
  }

  .news-card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .news-card-tag {
    position: absolute;
    top: 16px;
    left: 24px;
    background-color: #e9e7e4;
    color: #313639;
    padding: 4px 12px;
    border-radius: 100px;
    font-size: 14px;
    font-weight: 400;
    font-family: var(--font-family-primary);
    line-height: 18.2px;
    text-transform: capitalize;
  }

  .news-card-content {
    padding: var(--spacing-6);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
    flex: 1;
  }

  .news-card-date {
    font-size: 14px;
    font-weight: 400;
    font-family: var(--font-family-primary);
    color: #313639;
    margin: 0;
    line-height: 19.6px;
    text-transform: capitalize;
  }

  .news-card-title {
    font-size: 20px;
    font-weight: 500;
    font-family: var(--font-family-primary);
    color: #313639;
    margin: 0;
    line-height: 28px;
    flex: 1;
  }

  .news-card-link {
    font-size: 16px;
    font-weight: 700;
    font-family: var(--font-family-primary);
    color: #009ddb;
    text-decoration: none;
    display: inline-block;
    align-self: flex-start;
    transition: color var(--transition-base);
  }

  .news-card-link:hover {
    color: #005475;
    text-decoration: underline;
  }

  .news-footer {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-6);
  }

  .news-footer-text {
    font-size: 20px;
    font-weight: 400;
    font-family: var(--font-family-primary);
    color: #313639;
    margin: 0;
    line-height: 26px;
  }

  .news-footer-button {
    width: 212px;
    height: 40px;
    border-radius: 26px;
  }

  @media (max-width: 1023px) {
    .news-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .news-title {
      font-size: 36px;
      line-height: 40px;
    }
  }

  @media (max-width: 767px) {
    .news-grid {
      grid-template-columns: 1fr;
    }

    .news-title {
      font-size: 32px;
      line-height: 36px;
    }

    .news-subtitle {
      font-size: 18px;
      line-height: 24px;
    }

    .catalogs-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
